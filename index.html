<!DOCTYPE html>
<html>
<head>
  <title>Internet Speed Test</title>
</head>
<body>
  <h1>Internet Speed Test</h1>
  <button onclick="testDownloadSpeed()">Test Download Speed</button>
  <button onclick="testUploadSpeed()">Test Upload Speed</button>
  <button onclick="testPingRate()">Test Ping Rate</button>
  <button onclick="testJitter()">Test Jitter</button>
  <button onclick="testAll()">Test All</button>
  <div id="results"></div>

  <script>
    let resultsDiv = document.querySelector("#results");

    function testDownloadSpeed() {
      resultsDiv.innerHTML = "Testing download speed...";
      let startTime = new Date().getTime();
      let xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          let endTime = new Date().getTime();
          let duration = (endTime - startTime) / 1000;
          let fileSize = 100 * 1024 * 1024; // 100 MB in bytes
          let speed = fileSize / duration;
          let downloadSpeedMbps = (speed / (1024 * 1024)).toFixed(2);
          resultsDiv.innerHTML = "Your download speed is: " + downloadSpeedMbps + " Mbps";
        }
      };
      xhr.open("GET", "./100MB.bin", true);
      xhr.send();
    }

    function testUploadSpeed() {
      resultsDiv.innerHTML = "Testing upload speed...";
      let startTime = new Date().getTime();
      let fileSize = 100 * 1024 * 1024; // 100 MB in bytes
      let blob = new Blob([new ArrayBuffer(fileSize)], {type: 'application/octet-stream'});
      let xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          let endTime = new Date().getTime();
          let duration = (endTime - startTime) / 1000;
          let speed = fileSize / duration;
          let uploadSpeedMbps = (speed / (1024 * 1024)).toFixed(2);
          resultsDiv.innerHTML = "Your upload speed is: " + uploadSpeedMbps + " Mbps";
        }
      };
      xhr.open("POST", window.location.href, true);
      xhr.setRequestHeader("Content-Type", "application/octet-stream");
      xhr.send(blob);
    }

    function testPingRate() {
      resultsDiv.innerHTML = "Testing ping rate...";
      let startTime = new Date().getTime();
      let xhr = new XMLHttpRequest();
      let hostname = window.location.hostname;
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          let endTime = new Date().getTime();
          let duration = (endTime - startTime) / 1000;
          let pingRate = duration.toFixed(2);
          resultsDiv.innerHTML = "Your ping rate to " + hostname + " is: " + pingRate + " seconds";
        }
      };
      xhr.open("GET", "http://" + hostname + ":5000/ping", true);
      xhr.send();
    }
  
    function testJitter() {
      resultsDiv.innerHTML = "Testing jitter...";
      let xhr = new XMLHttpRequest();
      let hostname = window.location.hostname;
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          let endTime = new Date().getTime();
          let startTime = JSON.parse(xhr.responseText).start_time;
          let pingTime = JSON.parse(xhr.responseText).ping_time;
          let jitter = (endTime - startTime - pingTime) / 2;
          resultsDiv.innerHTML = "Your jitter to " + hostname + " is: " + jitter.toFixed(2) + " milliseconds";
        }
      };
      xhr.open("GET", "http://" + hostname + ":5000/jitter", true);
      xhr.send();
    }
  
    function testAll() {
      resultsDiv.innerHTML = "Testing all...";
      let downloadSpeed, uploadSpeed, pingRate, jitter;
  
      testDownloadSpeed();
      setTimeout(function() {
        downloadSpeed = resultsDiv.innerHTML;
        testUploadSpeed();
        setTimeout(function() {
          uploadSpeed = resultsDiv.innerHTML;
          testPingRate();
          setTimeout(function() {
            pingRate = resultsDiv.innerHTML;
            testJitter();
            setTimeout(function() {
              jitter = resultsDiv.innerHTML;
              resultsDiv.innerHTML = downloadSpeed + "<br>" + uploadSpeed + "<br>" + pingRate + "<br>" + jitter;
            }, 5000);
          }, 5000);
        }, 5000);
      }, 5000);
    }
    </script>
  </body>
</html>
